---
import Layout from '../layouts/Layout.astro';
import SearchBar from '../components/SearchBar.astro';
---

<Layout>
  <main class="min-h-screen flex items-center justify-center p-8">
    <div class="flex flex-col items-center w-full max-w-lg">
      <header class="text-center mb-12 text-white">
        <h1 class="text-5xl font-light mb-2 drop-shadow-lg">
          Weather App
        </h1>
        <p class="text-xl opacity-90 font-light">
          Consulta el clima de cualquier ciudad del mundo
        </p>
      </header>
      
      <SearchBar />
      
      <div id="weather-container" class="w-full justify-center hidden">
        <!-- El contenido se generar√° din√°micamente -->
      </div>
      
      <div id="loading" class="flex-col items-center text-white mt-8 hidden">
        <div class="w-10 h-10 border-4 border-white/30 border-t-white rounded-full animate-spin mb-4"></div>
        <p class="text-lg">Cargando...</p>
      </div>
      
      <div id="welcome" class="text-center text-white mt-8">
        <div class="text-6xl mb-4">üå§Ô∏è</div>
        <h2 class="text-3xl font-light mb-2 opacity-90">Bienvenido</h2>
        <p class="text-xl opacity-70 font-light">Busca una ciudad para ver su clima actual</p>
      </div>
    </div>
  </main>
</Layout>

<script>
  // Escuchar el evento personalizado de datos del clima
  document.addEventListener('weather-data', (event: any) => {
    const weatherData = event.detail;
    showWeatherData(weatherData);
  });
  
  function showWeatherData(data: any) {
    const weatherContainer = document.getElementById('weather-container')!;
    const welcome = document.getElementById('welcome')!;
    const loading = document.getElementById('loading')!;
    
    // Ocultar welcome y loading
    welcome.classList.add('hidden');
    loading.classList.add('hidden');
    
    // Crear el HTML de la tarjeta del clima usando Tailwind
    weatherContainer.innerHTML = `
      <div class="backdrop-blur-md bg-white/15 border border-white/20 rounded-3xl p-8 shadow-2xl max-w-md w-full text-center text-white">
        <div class="mb-6">
          <h2 class="text-2xl font-medium opacity-95 mb-2">${data.location.name}, ${data.location.country}</h2>
          <p class="text-sm opacity-70 capitalize">${new Date(data.location.localtime).toLocaleString('es-ES', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          })}</p>
        </div>
        
        <div class="mb-8">
          <div class="flex items-center justify-center gap-4 mb-2">
            <span class="text-6xl font-extralight leading-none">${Math.round(data.current.temp_c)}¬∞</span>
            <img src="${data.current.condition.icon}" alt="${data.current.condition.text}" class="w-20 h-20 drop-shadow-lg" />
          </div>
          <p class="text-lg opacity-90 font-light capitalize">${data.current.condition.text}</p>
        </div>
        
        <div class="space-y-4 pt-6 border-t border-white/20">
          <div class="flex justify-between items-center">
            <span class="opacity-80 font-light">Sensaci√≥n t√©rmica</span>
            <span class="font-medium">${Math.round(data.current.feelslike_c)}¬∞C</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="opacity-80 font-light">Humedad</span>
            <span class="font-medium">${data.current.humidity}%</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="opacity-80 font-light">Viento</span>
            <span class="font-medium">${Math.round(data.current.wind_kph)} km/h</span>
          </div>
        </div>
      </div>
    `;
    
    // Mostrar el contenedor y aplicar flex
    weatherContainer.classList.remove('hidden');
    weatherContainer.classList.add('flex');
    
    // Animar la aparici√≥n
    weatherContainer.style.opacity = '0';
    weatherContainer.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      weatherContainer.style.transition = 'all 0.5s ease';
      weatherContainer.style.opacity = '1';
      weatherContainer.style.transform = 'translateY(0)';
    }, 50);
  }
  
  // Funci√≥n para mostrar loading
  function showLoading() {
    const loading = document.getElementById('loading')!;
    const welcome = document.getElementById('welcome')!;
    const weatherContainer = document.getElementById('weather-container')!;
    
    loading.classList.remove('hidden');
    loading.classList.add('flex');
    welcome.classList.add('hidden');
    weatherContainer.classList.add('hidden');
    weatherContainer.classList.remove('flex');
  }
</script>
